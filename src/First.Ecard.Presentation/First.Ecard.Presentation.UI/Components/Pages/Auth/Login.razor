@page "/login"
@using First.Ecard.Presentation.UI.Components.Models
@using First.Ecard.Presentation.UI.Components.Shared
@using First.Ecard.Presentation.UI.Components.interfaces
@layout Layout.AuthLayout
@inject ILoginService LoginService
@inject NavigationManager Navigation

<PageTitle>Login</PageTitle>

<Loading IsLoading="@isLoading" />

  <main class="main-content  mt-0">
    <section>
      <div class="page-header min-vh-100">
        <EditForm class="container"  Model="model" OnValidSubmit="HandleLogin">
        <DataAnnotationsValidator />

          <div class="row">
          <div class="col-xl-3"></div>
            <div class="col-xl-5 col-lg-5 col-md-7 d-flex flex-column mx-lg-0 mx-auto">
              <div class="card card-plain">
                <div class="card-header pb-0 text-start">
                  <h4 class="font-weight-bolder">Authentification</h4>
                  <p class="mb-0">Entrez votre email et mot de passe pour se connecter</p>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                      <InputText type="email" @bind-Value="model.Email" class="form-control form-control-lg" placeholder="Email" aria-label="Email" />
                    </div>
                    <div class="mb-3">
                      <InputText type="text" @bind-Value="model.Password" class="form-control form-control-lg" placeholder="Mot de passe" aria-label="Mot de passe" />
                    </div>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="rememberMe">
                      <label class="form-check-label" for="rememberMe">Se souvenir de moi</label>
                    </div>
                    <div class="text-center">
                      <button type="submit" disabled="@isLoading" class="btn btn-lg btn-primary btn-lg w-100 mt-4 mb-0">Connexion
                      </button>
                    </div>
                </div>
              </div>
            </div>
          <div class="col-xl-4"></div>  
          </div>
        </EditForm>
      </div>
    </section>
  </main>

@code {
  private LoginRequest model = new LoginRequest();
  private bool isLoading = false;
  private string? error;

  private async Task HandleLogin()
  {
    isLoading = true;
    error = null;

    bool success = await LoginService.LoginAsync(model);
    isLoading = false;

    if(!success)
    {
      error = "Identifiants incorrects";
      return;
    }

    Navigation.NavigateTo(uri: "/", forceLoad: true);   
  }
}